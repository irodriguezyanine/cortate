<!-- frontend/templates/perfil_barbero.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil del Barbero</title>
  <link rel="stylesheet" href="/static/css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="perfil-barbero">
  <header class="header">
    <div class="container header-flex">
      <div class="logo">
        <a href="/"><h1>CÓRTATE,<span>CL</span></h1></a>
      </div>
      <nav>
        <ul>
          <li><a href="/explorar">Explorar</a></li>
          <li><a href="/perfil">Mi Perfil</a></li>
          <li><a href="/logout">Salir</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="perfil-barbero-box" id="perfilBarbero">
      <!-- Cargado dinámicamente -->
    </section>

    <section class="resenas-barbero" id="resenas">
      <h3>Reseñas de clientes</h3>
      <!-- Cargado dinámicamente -->
    </section>
  </main>

  <script>
    const barberoId = window.location.pathname.split("/").pop();

    async function cargarPerfilBarbero() {
      const res = await fetch(`/api/barbers/${barberoId}`);
      const barbero = await res.json();

      document.getElementById('perfilBarbero').innerHTML = `
        <div class="perfil-info">
          <img src="${barbero.imagen}" alt="${barbero.nombre}" class="perfil-img" />
          <div class="perfil-datos">
            <h2>${barbero.nombre}</h2>
            <p><strong>Ubicación:</strong> ${barbero.direccion}</p>
            <p><strong>Servicios:</strong> ${barbero.servicios.join(', ')}</p>
            <p><strong>Precio desde:</strong> $${barbero.precio}</p>
            <p><strong>Rating:</strong> ${barbero.promedioRating || 'Sin reseñas'}</p>
            <a class="btn" href="/reservar/${barbero._id}">Agendar una hora</a>
          </div>
        </div>
      `;
    }

    async function cargarResenas() {
      const res = await fetch(`/api/reviews/barber/${barberoId}`);
      const reviews = await res.json();

      if (reviews.length === 0) {
        document.getElementById('resenas').innerHTML += `<p>Aún no hay reseñas.</p>`;
        return;
      }

      document.getElementById('resenas').innerHTML += reviews.map(r => `
        <div class="card-resena">
          <p><strong>${r.usuarioNombre}:</strong> ${r.comentario}</p>
          <p>Rating: ${r.rating}/5</p>
        </div>
      `).join('');
    }

    window.onload = () => {
      cargarPerfilBarbero();
      cargarResenas();
    }
  </script>
</body>
</html>
